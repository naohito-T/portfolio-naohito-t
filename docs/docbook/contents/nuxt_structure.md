# 5. nuxt structure

## nuxt ディレクトリ構成

[リファレンス](https://ja.nuxtjs.org/docs/2.x/get-started/directory-structure)

- pagesディレクトリ
pagesディレクトリにはアプリケーションのビューとルートが含まれている
Nuxt.jsはこのディレクトリ内の.vueファイルを全て読み込み、アプリケーションのルーターを作成する。

- componentsディレクトリ
componentsディレクトリにはページにインポートする全てのVue.jsのコンポーネントファイルを入れる
Nuxt.jsを使用すると作成したコンポーネントを.vueファイルに自動でインポートすることができる。
nuxt.config.js内のcomponentsをtrueに設定するとNuxt.jsがスキャンして自動でインポートしてくれる。

## SPA・SSR・SSG とは

[URL](https://qiita.com/nishinoshake/items/f42e2f03663b00b5886d)

Nuxt.jsではSPA・SSR・SSGの中から好きなものを選んで開発ができる
初期設定ではSSRで動作するようになっている。

SPA(Single Page Application)

- メリット
  実装しやすい
  サーバの準備が楽
  SPAは、最もシンプルに実装でき、ホスティング先の選択肢が多いのが魅力です。
  ドキュメントで、NetlifyやGitHub Pagesへのデプロイ方法が紹介されていますが、単にファイルをアップすればいいだけなので、ロリポップのようなレンタルサーバーでも動きます

- デメリット
  初期表示が遅い
  SEOに不安がある
  OGをページごとに設定ができない OGってなんだっけ

SSR(Single Side Rendering)

- メリット
  SPAの欠点を解消できる

- デメリット
  実装がSPAより面倒
  サーバーの準備が面倒

  初回のリクエストをサーバーサイドでレンダリングして返すため、SPAの欠点を補うことができます。一方で、レンダリングするためのサーバーと、SSRを考慮した実装が必要になります。
  ドキュメントで、HerokuやNowへのデプロイ方法が紹介されていますが、Node.jsが動作するサーバーを用意できればなんでも大丈夫です。インフラに弱い人にはこのハードルが高い気がしますが、インフラに強い人や、好きなPaaSがある人にとっては、SSRが魅力的な選択肢になると思います。

SSG(Static Site Generation)

- メリット
  SPAの欠点を解消できる
  **サーバーの準備が楽**
  SSRよりも速い
  更新が少ないWebサイト
  ドキュメントやブログ

- デメリット
  実装が少し面倒
  用途が限られる

各ルートのHTMLをあらかじめ生成するため、SSRよりもレスポンスが速いのが魅力です。また、静的ファイルを生成するおかげで、SPAと同じようにホスティング先の選択肢が広がります。

生成時にはサーバーサイドでレンダリングすることになるので、SSRを考慮した実装が必要になるのと、SSGには向き不向きがあるので、Webサイトの要件を考えて慎重に選択する必要があります。

## Vueの歴史

Vue2.xではコンポーネントをSFC(シングルファイルコンポーネント)ファイルに記述する
SFCにコンポーネントのView/状態/ロジックをまとめて閉じ込めて記述することできて便利だが
これ以上は分割ができないという欠点があった。
これを解決するのがComposition API

Composition APIによってコンポーネントのコードを整理する際に開発者により高い柔軟性を提供する。
コンポーネント間でロジックや状態を抽出して再利用することが簡単になる。

SFCに記述するのはViewの見た目に関することだけにして、ロジックや状態を外部に切り出せるようになる。

つまり、SFCにはViewの見た目に関することだけを記述していく。
## 当該プロジェクトでのVuexの導入方法

[参考URL](https://qiita.com/Takabun/items/e0b0c139ccf53c7bb561)

## Vuexについて

VuexはVue.jsでグローバルでのデータの状態管理を行うことができるライブラリ
Vuexはこれまでprops, emitを利用した親子間のコンポーネントでの状態管理の複雑さを解消するために用いられてきた。
このライブラリによりどのコンポーネントからでも状態にアクセスしたり、アクションを実行することができる

## Vuexを使用するにあたっての弊害

・TypeScriptとの相性が悪い
・アーキテクチャが複雑で手軽に扱うことが難しい
・コンポーネントをテストすることが難しい

こういった課題を解決するためにVue.jsの2.2以降にprovide、injectといったDIを行うことができる関数が追加された

- DI 依存性の注入
依存性の注入とはコンポーネント間の依存関係をプログラムのソースコードから排除するために、外部の設定ファイルなどでオブジェクトを注入できるようにするソフトウェアパターンである。

## 今日のVuexとは

今までのVue2時にはVuex。しかしVue3ではprovide/injectを使ったステート管理が推進されている

## composition APIとは

[参考URL](https://qiita.com/karamage/items/7721c8cac149d60d4c4a)

Vue3の目玉の機能としてComposition APIがある。
Compositionは構成(すること),組み立て(ること)という意味

- なぜComposition APIを使うのか
理由としてはロジックの抽出と再利用をするため。他にもTypeScript型強化などが理由に挙げられる

ロジックの抽出と再利用が必要な理由は
複雑に肥大化したコンポーネントを小分けにして関心事で分別し、クリーンな状態に整理するため
近年Vueを使用して大規模なプロジェクトを構築することが増えた。肥大化してメンテしにくいコンポーネントを目の辺りにしエンジニアが苦しむことがあった。

- 今までのVue
Vue2.xではコンポーネントをSFC(シングルファイルコンポーネント)ファイルに記述する
SFCにコンポーネントのView/状態/ロジックをまとめて閉じ込めて記述することできて便利だが
これ以上は分割ができないという欠点があった。
これを解決するのがComposition API

Composition APIによってコンポーネントのコードを整理する際に開発者により高い柔軟性を提供する。
コンポーネント間でロジックや状態を抽出して再利用することが簡単になる。

SFCに記述するのはViewの見た目に関することだけにして、ロジックや状態を外部に切り出せるようになる。

ただしComposition APIのベストプラクティスを今決めるのは時期尚早であり、手探りですすめる必要がある
つまりVueが管理している壁の中の世界から壁の外の無秩序な荒野へと放たれる
設計が重要になる。

Composition APIを使用するデメリットは設計やアーキテクチャを考えなければならない。
例えばクリーンアーキテクチャを理解して実装していくことが求められる

## composition APIにおいてのProviderパターン

[参考URL](https://qiita.com/karamage/items/4bc90f637487d3fcecf0)

- Providerパターンとは
VueにおけるProviderパターンとはprovide/inject APIを使用してComposition APIで切り出した状態やロジックをコンポーネント間で共有することを指す。

## provide/injectの使い方

提供する側(provide)と注入する側(inject)に分かれる

- 送信側(provide)
親コンポーネントで送信を定義

- 受信側(inject)
親コンポーネントから呼び出されている子コンポーネントはinject(key)で使用する。

## 今後ProviderのAPIは変わるかも

もともとPlugin開発やライブラリ開発向けのAPIとして「provide/inject」が用意されていました。
つまり、「provide/inject」はVue3用に用意されたAPIではないのです。
よって、Providerの仕組みは、今後、変わるかもしれません。
「provide/inject」仕組みは、問題点も多いからです。
例えばKeyを書き間違えたら不具合を引き起こしますが、それが実行時にしかわからないです。
injectの対象がコンポーネント単位のため、依存が大きいです。(もっと依存度を下げて使いたい)
今後Vue3で改善されると予想しています。

しかし、抽象レベルの「Providerパターン」の考え方は変わりませんので、知っておいて損はないかと思います。

- まとめ
Composition APIを使って、散らかった部屋の荷物をダンボールに梱包して、外に出そう。
Composition APIを使って梱包した荷物を運ぶのがProviderの役目
Providerで、親コンポーネントから子コンポーネントに共通の状態を簡単に受け渡すことができる。
Prop渡しと違ってバケツリレーをする必要がない。
今後、Vue3ではProviderの改善が進むと予想
